 # Maintainer: Levente Polyak 
# Contributor: Llewelyn Trahaearn 
# Contributor: FadeMind 
# Contributor: Maxime Gauduin 
# Contributor: bitwave 
# Contributor: willemw 
# Contributor: Balló György 

pkgbase=libappindicator
pkgname=("${pkgbase}-gtk3")
pkgver=12.10.0
pkgrel=12
pkgdesc='Allow applications to extend a menu via Ayatana indicators in Unity, KDE or Systray'
url='https://launchpad.net/libappindicator'
arch=('armv6h')
license=('LGPL2.1' 'LGPL3')
makedepends=('dbus-glib' 'gobject-introspection' 'gtk-sharp-2'
             'libdbusmenu-gtk3' 'libindicator-gtk3'
             'mono' 'perl-xml-libxml' 'pygtk' 'vala' 'python2')
options=('!emptydirs')
source=(http://launchpad.net/${pkgbase}/${pkgver%.*}/${pkgver}/+download/${pkgbase}-${pkgver}.tar.gz)
#        improved-plasma.patch
#        no-python.patch)
sha512sums=('317a22a23c8ed84e74207b64b2e9683992d1fb7208176637a051dfe925974f966d1cfa31e650b45eaf839ab61641dee8fbebc8a07882a09b0dd766d88b8d5b9a')
#            '8a970b2ede4aa6c7596b5db9f637e4c383a7568222a8bd4a5a8c201eae7599380976ee7726b60b473f03f1a364962acc06a6e3d567de594e3db7ba7927257a01'
#            'd739c0c91eedba327089da827cbdd6f37a17e76736acf1113367aa1de1ca81671671c881f587181026f7bb2eb1c055b5f464082e08c52a8ed03c2b8e1df4a02f')
#validpgpkeys=('6FC05581A37D71FCECE165DB5BE41E162CD6358E')  # Charles Kerr 

#prepare() {
#  (cd ${pkgbase}-${pkgver}
#    sed 's|/cli/|/mono/|' -i bindings/mono/{appindicator-sharp-0.1.pc.in,Makefile.in}
#    sed 's/example //g' -i Makefile.in
#    patch -p1 < "${srcdir}/improved-plasma.patch"
#  )
  # python enabled variant
#  cp -ra ${pkgbase}-${pkgver}{,-py2}
  # disable python for gtk2 + gtk3 variant
#  (cd ${pkgbase}-${pkgver}; patch -p1 < "${srcdir}/no-python.patch")
#  cp -ra ${pkgbase}-${pkgver}{,-gtk2}
#}

build() {
  export CFLAGS="${CFLAGS} -Wno-deprecated-declarations"
  export CSC='/usr/bin/mcs'

  msg2 'Building gtk3...'
  (cd ${pkgbase}-${pkgver}
    ./configure --prefix=/usr \
      --sysconfdir=/etc \
      --localstatedir=/var \
      --disable-{gtk-doc-html,mono-test,static,tests} \
      --with-gtk=3
    make
  )

}

package_libappindicator-gtk3() {
  pkgdesc+=' (GTK+ 3 library)'
  depends=('libdbusmenu-gtk3' 'libindicator-gtk3')
  provides=("${pkgbase}3")
  conflicts=("${pkgbase}3")

  cd ${pkgbase}-${pkgver}
  make -j1 DESTDIR="${pkgdir}" install
  make -j1 -C bindings/mono DESTDIR="${pkgdir}" uninstall
  rm -rf "${pkgdir}"/usr/share/gtk-doc
}
